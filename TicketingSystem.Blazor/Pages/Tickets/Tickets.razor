@page "/tickets"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@using TicketingSystem.Application.Tickets.Queries.GetClientTickets
@inject TicketService TicketService
@inject ISnackbar Snackbar

<MudText Typo="Typo.h4" Class="mb-4">Tichetele Mele</MudText>

<MudTable Items="@tickets" Hover="true" Elevation="2" Loading="@_loading" LoadingProgressColor="Color.Info">
    <HeaderContent>
        <MudTh>Titlu</MudTh>
        <MudTh>Status</MudTh>
        <MudTh>Data</MudTh>
        <MudTh>Acțiuni</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Titlu">@context.Title</MudTd>
        <MudTd DataLabel="Status">
            <MudChip T="string" Color="@GetColor(context.Status)" Size="Size.Small">@context.Status</MudChip>
        </MudTd>
        <MudTd DataLabel="Data">@context.CreatedAt.ToShortDateString()</MudTd>
        <MudTd>
            <MudButton Variant="Variant.Outlined" Color="Color.Primary" Size="Size.Small">Detalii</MudButton>
        </MudTd>
    </RowTemplate>
    <NoRecordsContent>
        <MudText>Nu am găsit niciun tichet.</MudText>
    </NoRecordsContent>
</MudTable>

@code {
    private List<GetClientTicketsQueryResponseDto> tickets = new();
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        try 
        {
            tickets = await TicketService.GetTickets();
        }
        finally 
        {
            _loading = false;
        }
    }

    private Color GetColor(string status) => status switch
    {
        "Open" => Color.Success,
        "Closed" => Color.Error,
        "InProgress" => Color.Warning,
        _ => Color.Default
    };
}